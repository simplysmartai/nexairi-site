{
  "name": "NEX_LONGFORM_PUBLISH",
  "nodes": [
    {
      "parameters": {},
      "id": "trg-1",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [-700, 80]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"requests\": [\n    { \"genre\": \"Lifestyle\",  \"agent\": \"lifestyle_scout\", \"topic\": \"Holiday Evenings Reset 2.0 (calm evenings that actually happen)\" },\n    { \"genre\": \"Technology\", \"agent\": \"tech_scout\",      \"topic\": \"Winter smart-home routine (heat, light, power without drilling)\" },\n    { \"genre\": \"Travel\",     \"agent\": \"travel_scout\",    \"topic\": \"Holiday layover field guide (turn stopovers into breaks)\" },\n    { \"genre\": \"Sports\",     \"agent\": \"sports_scout\",    \"topic\": \"Bowl season playbook (catch the right games, keep weekends sane)\" }\n  ]\n}\n"
      },
      "id": "set-requests",
      "name": "Set Requests",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-480, 80]
    },
    {
      "parameters": {
        "jsCode": "const reqs = $json.requests || [];\nreturn reqs.map(r => ({ json: r }));"
      },
      "id": "code-split",
      "name": "Split Requests",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-260, 80]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ROLE: You are the {{ $json.genre }} longform writer (agent: {{ $json.agent }}). Produce a fully fact-checked, human-readable article that fits the Nexairi brand.\n\nREQUIREMENTS (return JSON only):\n{\n  \"title\": string,\n  \"dek\": string,\n  \"slug\": string (url-safe),\n  \"tldr\": { \"bullets\": [string, string, string, string, string] },\n  \"tags\": [string],\n  \"author\": string,\n  \"body_html\": string (1500-2000 words, valid HTML with <h2>, <h3>, <p>, <ul>, <li>, no <script>),\n  \"sources\": [ { \"name\": string, \"url\": string } ]\n}\n\nTOPIC: \n{{ $json.topic }}\n\nEDITORIAL RULES:\n- 1500-2000 words in body_html (aim for ~1700).\n- Open with a tight dek.\n- Include a TL;DR of 5 bullets (in tldr.bullets).\n- Use specific examples and concrete steps.\n- No hallucinations; prefer primary/official sources.\n- Use neutral, friendly tone; avoid hype.\n- Output ONLY the JSON object (no prose, no fences)."
      },
      "id": "llm",
      "name": "Longform LLM",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [-20, 80]
    },
    {
      "parameters": {
        "jsCode": "let raw = ($json.text || $json.output || $json.data || '').toString().trim();\nif (!raw) throw new Error('No text from LLM');\nif (raw.startsWith('```')) raw = raw.replace(/^```[a-zA-Z]*\\n?/, '').replace(/```$/, '');\nlet parsed;\ntry { parsed = JSON.parse(raw); } catch (e) { throw new Error('JSON parse failed: ' + e.message); }\nif (!parsed.title || !parsed.body_html || !parsed.slug) throw new Error('Missing fields');\n// Word count\nconst text = parsed.body_html.replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim();\nconst wc = text ? text.split(' ').length : 0;\nif (wc < 1400 || wc > 2300) { throw new Error('Word count out of range: ' + wc); }\nreturn [{ json: parsed }];"
      },
      "id": "validate",
      "name": "Validate + Count",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [200, 80]
    },
    {
      "parameters": {
        "jsCode": "const a = $json;\nconst title = a.title;\nconst dek = a.dek || '';\nconst slug = a.slug;\nconst tags = (a.tags || []).join(' · ');\nconst bullets = (a.tldr && Array.isArray(a.tldr.bullets)) ? a.tldr.bullets : [];\nconst body = a.body_html || '';\nfunction esc(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }\nconst tldrHtml = bullets.length ? `<section class=\"nx-article__tldr\"><h3>TL;DR</h3><ul class=\"nx-list\">${bullets.map(b=>`<li>${esc(b)}</li>`).join('')}</ul></section>` : '';\nconst html = `<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>${esc(title)} | Nexairi Mentis</title>\n  <link rel=\"stylesheet\" href=\"/css/styles.css\">\n  <link rel=\"icon\" type=\"image/png\" href=\"/Images/nexairi-mentis-favicon.png\">\n</head>\n<body>\n  <header class=\"nx-header\">\n    <div class=\"nx-header__inner\">\n      <div class=\"nx-brand\">\n        <a class=\"nx-logo-link\" href=\"/\"><img class=\"nx-logo nx-logo--full\" src=\"/Images/nexairi-mentis-logo-horizontal.png\" alt=\"Nexairi logo\"><img class=\"nx-logo nx-logo--compact\" src=\"/Images/nexairi-mentis-logo-compact.png\" alt=\"Nexairi compact logo\"></a>\n        <div><p class=\"nx-eyebrow\">${esc($json.genre||'')}</p><p class=\"nx-tagline\">Human taste. Automated pace.</p></div>\n      </div>\n      <nav class=\"nx-nav\"><a href=\"/\">Home</a><a href=\"/mission\">Our Mission</a><a href=\"/lifestyle\">Lifestyle</a><a href=\"/travel\">Travel</a><a href=\"/technology\">Technology</a><a href=\"/sports\">Sports</a><a href=\"/sandbox\">Sandbox</a><a href=\"/contact\">Contact</a></nav>\n    </div>\n  </header>\n  <main class=\"nx-shell\">\n    <article class=\"nx-article\">\n      <header><h1>${esc(title)}</h1><p class=\"nx-dek\">${esc(dek)}</p></header>\n      <section class=\"nx-article__meta\"><span class=\"nx-eyebrow\">By ${esc(a.author||'Nexairi Staff')} · 7–9 min read</span></section>\n      ${tldrHtml}\n      <section class=\"nx-article__body\">${body}</section>\n      <p class=\"nx-eyebrow\" style=\"margin:12px 0 8px 0;\">TAGS: ${esc(tags)}</p>\n      <div style=\"border-top:1px solid rgba(15,23,40,0.1);margin:24px 0;\"></div>\n      <div class=\"nx-ad\" style=\"margin:0 0 16px 0;\"><strong>Ad slot</strong><span>970x250 / responsive</span></div>\n    </article>\n  </main>\n  <footer class=\"nx-footer\">\n    <div class=\"nx-shell nx-footer__wrap\">\n      <div class=\"nx-footer__links nx-footer__left\"><a href=\"/\">Home</a><a href=\"/mission\">Our Mission</a><a href=\"/lifestyle\">Lifestyle</a><a href=\"/technology\">Technology</a><a href=\"/travel\">Travel</a><a href=\"/sports\">Sports</a></div>\n      <div class=\"nx-footer__center\">&copy; 2025 Nexairi Mentis</div>\n      <div class=\"nx-footer__links nx-footer__right\"><a href=\"/sandbox\">Sandbox</a><a href=\"/contact\">Contact</a><a href=\"/privacy\">Privacy</a><a href=\"/sitemap.html\">Sitemap</a><a href=\"/sitemap.xml\">XML Sitemap</a></div>\n    </div>\n  </footer>\n</body>\n</html>`;\nreturn [{ json: { html, slug, title, topic: title } }];"
      },
      "id": "build",
      "name": "Build Nexairi HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 80]
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "create",
        "owner": { "__rl": true, "value": "simplysmartai", "mode": "name" },
        "repository": { "__rl": true, "value": "nexairi-site", "mode": "name" },
        "filePath": "={{ 'site/posts/' + ($json.slug || 'nexairi-article') + '.html' }}",
        "fileContent": "={{ $json.html }}",
        "commitMessage": "={{ 'Publish (longform): ' + ($json.title || $json.slug) }}",
        "additionalParameters": { "branch": { "branch": "main" } }
      },
      "id": "github",
      "name": "Off to Github (longform)",
      "type": "n8n-nodes-base.github",
      "typeVersion": 1.1,
      "position": [680, 80]
    }
  ],
  "connections": {
    "Manual Trigger": { "main": [[{ "node": "Set Requests", "type": "main", "index": 0 }]] },
    "Set Requests": { "main": [[{ "node": "Split Requests", "type": "main", "index": 0 }]] },
    "Split Requests": { "main": [[{ "node": "Longform LLM", "type": "main", "index": 0 }]] },
    "Longform LLM": { "main": [[{ "node": "Validate + Count", "type": "main", "index": 0 }]] },
    "Validate + Count": { "main": [[{ "node": "Build Nexairi HTML", "type": "main", "index": 0 }]] },
    "Build Nexairi HTML": { "main": [[{ "node": "Off to Github (longform)", "type": "main", "index": 0 }]] }
  },
  "active": false,
  "settings": { "executionOrder": "v1" },
  "versionId": "nx-longform-v1",
  "id": "NEX_LONGFORM_PUBLISH",
  "tags": []
}

